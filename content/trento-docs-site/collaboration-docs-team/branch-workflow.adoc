= Managing a single documentation repository with multiple branches

== Summary

This guide describes the workflow for maintaining synchronized documentation branches in a single repository. The Trento Development team and the Documentation team collaborate using this workflow to ensure documentation consistency across versions.

== Repository structure

The documentation repository contains:

`main` branch::
  Contains the latest pre-released development documentation for the trento open source project.
  Uses `version: ~` and `display_version: pre-release` in the `antora.yml` file.

`suse` branch::
  Contains the official released version of Trento documentation at link:https://documentation.suse.com/en-us/sles-sap/trento/html/SLES-SAP-trento/index.html[SUSE official docs portal].
  Uses `version: latest` in `antora.yml` file.

The link:https://github.com/trento-project/docs/tree/suse[`suse`] branch will always represent the latest released version of Trento.

== Synchronization of main and suse branch

Synchronize the branches as often as possible, but at least weekly during or after the Documentation team sync call.
This procedure ensures all improvements from `main` are included in the release suse branch.

=== Synchronization steps

.Procedure: Synchronizing release branch with main
. Fetch the latest changes from the remote repository:
+
[source,bash]
----
$ git fetch origin
----

. Switch to the release branch:
+
[source,bash]
----
$ git checkout suse
----

. Start the rebase operation:
+
[source,bash]
----
$ git rebase main
----
+

. Resolve changes
+
[source,bash]
----
$ git rebase --continue
----

. Push the updated branch to the remote repository:
+
[source,bash]
----
$ git push --force-with-lease
----
+
[IMPORTANT]
====
Always use `--force-with-lease` instead of `--force` to prevent accidental overwrites of others' work.
====

== Verification

After synchronization, verify the changes:

.Procedure: Verifying synchronization results
. Check which files differ between branches:
+
[source,bash]
----
$ git diff main
----

== Guidelines for team members

=== Development team responsibilities

* Commit all new features and fixes to `main` first
* Perform regular synchronization after sync calls
* Communicate before force-pushing to suse branch

== Troubleshooting

[qanda]
Why do we always get a conflict with antora.yml?::
  The `main` branch uses `version: ~` while the release branch uses `version: suse`.
  This difference is intentional and the conflict is expected.

What if someone else pushed to the release branch?::
  Coordinate with them first.
  Pull their changes before rebasing:
  `git pull origin suse`

How can I preview changes before pushing?::
  - Create a draft pull request from your local branch to review changes before force-pushing.
  - Build antora page locally to preview the page